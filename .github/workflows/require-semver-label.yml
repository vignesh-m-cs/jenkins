name: Require PR Label
on:
  pull_request:
    types: [opened, edited, labeled, unlabeled, synchronize]

jobs:
  check-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Require semver label
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.payload.pull_request.number;
            const labels = context.payload.pull_request.labels.map(l => l.name);
            const requiredLabels = ["semver:major", "semver:minor", "semver:patch"];

            const hasRequiredLabel = labels.filter(l => requiredLabels.includes(l));

            if (hasRequiredLabel.length !== 1) {
            const body = "Please add exactly one of these labels before merging: semver:major - breaking changes, semver:minor - new features (backward-compatible), semver:patch - bug fixes. Once you add a valid label, the check will pass.";


              await github.rest.issues.createComment({
                ...context.repo,
                issue_number,
                body
              });

              core.setFailed("PR must have exactly one semver label.");
            }
